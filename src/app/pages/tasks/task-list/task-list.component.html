<!--Complex task list screen for task management and report export-->
<div class="basic-screen-header" fxLayout="row">
    <div class="pl-50" fxFlex="130px" fxLayoutAlign="start center">
        <h2>{{'task.title' | translate}}</h2>
    </div>
    <div [formGroup]="areaGroup" class="header-select" fxFlex fxLayoutAlign="start center">
        <mat-form-field class="pt-17 w-250">
            <mat-label>{{'businessArea.title' | translate}}</mat-label>
            <mat-select (selectionChange)="setTableData()" formControlName="businessArea">
                <mat-option value="all">{{'all.things' | translate}}</mat-option>
                <mat-option *ngFor="let businessArea of businessAreaList"
                            [value]="businessArea.name"
                >
                    {{businessArea.codeItem}} - {{businessArea.name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
    </div>
    <div fxFlex fxLayoutAlign="end center">
        <button (click)="createTask()" *ngIf="projectEventService.instant.active && hasCreateTaskRole()" class="mr-10" color="accent"
                mat-flat-button
        >
            {{'common.create' | translate}}
        </button>
        <button (click)="export()" *ngIf="hasRoleExportReportTask()" class="mr-10" color="accent" mat-flat-button>
            {{'common.export' | translate}}
        </button>
    </div>
</div>

<haz-indeterminate-progress-bar [loading]="loading"></haz-indeterminate-progress-bar>
<haz-core-table #taskTable
                (requestData)="setTableData($event)"
                [configuration]="config"
                [data]="data"
></haz-core-table>
<ng-template #updateColumn let-actRow="row" let-context="context">
    <div *ngIf="hasReadOrUpdateTaskRole()" class="fr">
        <button (click)="update(actRow.id)"
                mat-icon-button
        >
            <mat-icon>keyboard_arrow_right</mat-icon>
        </button>
    </div>
</ng-template>
<ng-template #statusColumn let-actRow="row" let-context="context">
    {{('task.statusValue.' + actRow.state.toLowerCase()) | translate}}
</ng-template>
<ng-template #taskTypeColumn let-actRow="row" let-context="context">
    {{('task.taskTypeValue.' + actRow.taskType.toLowerCase()) | translate}}
</ng-template>
<ng-template #venueColumn let-actRow="row" let-context="context">
    {{actRow.cityName | venue}}
</ng-template>
<ng-template #userColumn let-actRow="row" let-context="context">
    <ng-container *ngIf="actRow.responsibleUser">
        {{actRow.responsibleUser.firstName}} {{actRow.responsibleUser.lastName}}
    </ng-container>
</ng-template>
<ng-template #dateColumn let-actRow="row" let-context="context">
    {{actRow.dueDate  | date:'d.M.yyyy'}}
</ng-template>
<ng-template #trafficLightColumn let-actRow="row" let-context="context">
    <div *ngIf="actRow.trafficLight === 'RED'"
         style="width: 12px;height: 12px;background:#ce211f;border-radius:50%;"
    ></div>
    <div *ngIf="actRow.trafficLight === 'GREEN'"
         style="width: 12px;height: 12px;background:#20bf55;border-radius:50%;"
    ></div>
    <div *ngIf="actRow.trafficLight === 'AMBER'"
         style="width: 12px;height: 12px;background:#f79824;border-radius:50%;"
    ></div>
</ng-template>
