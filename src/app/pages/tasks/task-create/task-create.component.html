<div fxLayout="row"
     class="task-header m-0 p-0">

    <div fxFlex="90"
         class="ml-20"
         fxLayoutAlign="start center"
    >
        <h3 class="m-0">
            {{ 'tasks.new.newTask' | translate }}
        </h3>
    </div>
</div>

<div fxLayout="row">
    <div fxFlex="70">
        <form [formGroup]="taskForm">
            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >
                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.type' | translate }} *</mat-label>
                        <mat-select formControlName="type" (selectionChange)="onTypeChanged($event.value)">
                            <mat-option *ngFor="let type of allTypes" [value]="type">
                                {{type}}
                            </mat-option>
                        </mat-select>
                        <mat-error
                            *ngIf="f?.type?.errors?.required">{{ 'tasks.type' | translate }} {{ 'error.isRequired' | translate }}</mat-error>
                    </mat-form-field>

                </div>

                <div
                    *ngIf="f.type.value == 'issue'"
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.trafficLight' | translate }} *</mat-label>
                        <mat-select formControlName="trafficLight">
                            <mat-select-trigger>
                                <mat-icon
                                    class="traffic-light-icon"
                                    [ngClass]="f?.trafficLight?.value == 'red' ? 'color-red' :
											 f?.trafficLight?.value == 'amber' ? 'color-amber' :
											 f?.trafficLight?.value == 'green' ? 'color-green' :
											 f?.trafficLight?.value == 'none' ? 'color-none' : 'color-none'"
                                >
                                    check_circle
                                </mat-icon>
                                <span
                                    class="traffic-light-label"
                                    [ngClass]="f?.trafficLight?.value == 'red' ? 'color-red' :
										 f?.trafficLight?.value == 'amber' ? 'color-amber' :
										 f?.trafficLight?.value == 'green' ? 'color-green' :
										 f?.trafficLight?.value == 'none' ? 'color-none' : 'color-none'"
                                >
							{{f.trafficLight.value}}
						</span>
                            </mat-select-trigger>
                            <mat-option *ngFor="let trafficLight of alltraficLights" [value]="trafficLight">
                                <mat-icon
                                    class="traffic-light-icon-in-options"
                                    [ngClass]="trafficLight == 'red' ? 'color-red' :
											 trafficLight == 'amber' ? 'color-amber' :
											 trafficLight == 'green' ? 'color-green' :
											 trafficLight == 'none' ? 'color-none' : 'color-none'"
                                >
                                    check_circle
                                </mat-icon>
                                <span class="traffic-light-label-in-options"
                                      [ngClass]="trafficLight == 'red' ? 'color-red' :
											 trafficLight == 'amber' ? 'color-amber' :
											 trafficLight == 'green' ? 'color-green' :
											 trafficLight == 'none' ? 'color-none' : 'color-none'"
                                >
							{{trafficLight}}
						</span>
                            </mat-option>
                        </mat-select>
                        <mat-error
                            *ngIf="f?.trafficLight?.errors?.required">{{ 'tasks.trafficLight' | translate }} {{ 'tasks.forIssue' | translate }} {{ 'error.isRequired' | translate }}</mat-error>
                    </mat-form-field>

                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="two-columns-width theme-input">
                        <mat-label>{{ 'tasks.title' | translate }}... *</mat-label>
                        <input matInput formControlName="title">
                        <mat-error
                            *ngIf="f?.title?.errors?.required">{{ 'tasks.title' | translate }} {{ 'error.isRequired' | translate }}</mat-error>
                    </mat-form-field>

                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >
                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.businessArea' | translate }} *</mat-label>
                        <mat-select formControlName="businessArea"
                                    (selectionChange)="onBusinessAreaChanged($event.value)">
                            <mat-option *ngFor="let businessArea of allBusinessAreas" [value]="businessArea">
                                {{businessArea?.code}} - {{businessArea?.name}}
                            </mat-option>
                        </mat-select>
                        <mat-error
                            *ngIf="f?.businessArea?.errors?.required">{{ 'tasks.businessArea' | translate }} {{ 'error.isRequired' | translate }}</mat-error>
                    </mat-form-field>

                </div>

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="code-prefix-width theme-input px-0">
                        <input type="text" matInput class="code-prefix" disabled [value]="codePrefix">
                    </mat-form-field>

                    <mat-form-field appearance="fill" class="code-width theme-input ml-10">
                        <mat-label>{{ 'tasks.code' | translate }} *</mat-label>
                        <input matInput formControlName="code">
                        <mat-error
                            *ngIf="f?.code?.errors?.required">{{ 'tasks.code' | translate }} {{ 'error.isRequired' | translate }}</mat-error>
                    </mat-form-field>

                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >
                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.sourceOfAgenda' | translate }}</mat-label>
                        <mat-select formControlName="sourceOfAgenda">
                            <mat-option class="color-none">{{ 'tasks.empty' | translate }}</mat-option>
                            <mat-option *ngFor="let sourceOfAgenda of allSourceOfAgendas" [value]="sourceOfAgenda">
                                {{sourceOfAgenda}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                </div>

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.phase' | translate }}</mat-label>
                        <mat-select formControlName="phase">
                            <mat-option class="color-none">{{ 'tasks.empty' | translate }}</mat-option>
                            <mat-option *ngFor="let phase of allPhases" [value]="phase">
                                {{phase?.dateFrom}} - {{phase?.dateTo}} {{phase?.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="due-date-width theme-input">
                        <mat-label>{{ 'tasks.dueDate' | translate }}</mat-label>
                        <input matInput [matDatepicker]="picker" (dateChange)="onDateChanged($event.value)"
                               formControlName="dueDate">
                        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                        <mat-datepicker #picker></mat-datepicker>
                        <mat-error *ngIf="dateInvalid">{{ 'error.dateFormatIsInvalid' | translate }}</mat-error>
                    </mat-form-field>

                </div>

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="theme-input">
                        <mat-label>{{ 'tasks.responsible' | translate }}</mat-label>
                        <mat-select formControlName="responsible">
                            <mat-option class="color-none">empty</mat-option>
                            <mat-option *ngFor="let responsible of allResponsibles" [value]="responsible">
                                {{responsible?.firstName}} {{responsible?.lastName}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>

                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="two-columns-width theme-input">
                        <mat-label>{{ 'tasks.venue' | translate }}</mat-label>
                        <mat-select formControlName="venue">
                            <mat-option *ngFor="let venue of allVenues" [value]="venue">
                                {{venue}}
                            </mat-option>
                            <mat-option value="both">{{ 'tasks.both' | translate }}</mat-option>
                            <mat-option value="none">{{ 'tasks.none' | translate }}</mat-option>
                        </mat-select>
                    </mat-form-field>


                </div>

            </div>

            <div
                fxLayout="row"
                fxLayoutAlign="start center"
                fxLayout.xs="column"
                fxLayout.sm="column"
                class="indentation"
            >

                <div
                    fxLayoutAlign="start center"
                    class="mt-20 mr-15"
                >

                    <mat-form-field appearance="fill" class="two-columns-width theme-input">
                        <mat-label>{{ 'tasks.description' | translate }}...</mat-label>
                        <textarea matInput rows="7" formControlName="description"></textarea>
                    </mat-form-field>

                </div>

            </div>

            <div>
                <button type="submit"
                        mat-flat-button
                        color="accent"
                        class="mr-10"
                        (click)="onSave()"
                >
                    {{ 'tasks.save' | translate }}
                </button>
                <button type="button"
                        mat-button
                        class="mr-10"
                        (click)="onCancel()"
                >
                    {{ 'tasks.cancel' | translate }}
                </button>


            </div>
        </form>
    </div>

    <div fxFlex="30" style="background:#F4F4F4" fxLayout="column">
        <div style="height: 70vh; overflow-x: auto;">
            <task-comment></task-comment>
            <task-comment></task-comment>
            <task-comment></task-comment>
        </div>

        <div>
            <mat-form-field class=" m-20">
                <textarea matInput placeholder="Add comment"></textarea>
            </mat-form-field>
            <button mat-icon-button>
                <mat-icon matSuffix>send</mat-icon>
            </button>
        </div>
    </div>
</div>
