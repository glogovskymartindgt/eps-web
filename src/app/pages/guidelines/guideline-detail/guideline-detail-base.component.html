<iihf-header>
    <h3 title>{{labelKey | translate}}</h3>

    <ng-container buttons>
        <ng-container *ngIf="!editMode && isOpenProject()">
            <button
                (click)="enableEdit()"
                *iihfShowByRole="roles.RoleUpdateGuideline"
                class="mr-10"
                color="accent"
                mat-flat-button
            >
                {{'common.edit' | translate}}
            </button>
        </ng-container>

        <ng-container *ngIf="updateScreen">
            <iihf-delete-button
                *iihfShowByRole="roles.RoleDeleteGuideline"
                [options]="deleteButtonOptions"
                class="mr-10"
                color="accent"
            ></iihf-delete-button>
        </ng-container>
    </ng-container>
</iihf-header>

<div fxLayout="row" style="overflow: auto; height: calc(100vh - 160px);">
    <div class="p-30">
        <form [formGroup]="guidelineDetailForm">
            <div class="long-input">
                <haz-copy-core-input
                    [label]="'guidelines.detail.title' | translate"
                    [required]="true"
                    [type]="'textarea'"
                    appearance="fill"
                    [formControlName]="formControlNames.TITLE"
                >
                </haz-copy-core-input>
            </div>

            <mat-form-field appearance="fill" class="long-input">
                <mat-label>{{ 'guidelines.detail.businessArea' | translate }}</mat-label>

                <haz-select-search
                    [formControlName]="formControlNames.BUSINESS_AREA"
                    [searchable]="true"
                    [selectList]="businessAreas$ | async"
                    [required]="true"
                >
                </haz-select-search>

                <mat-error *ngIf="businessAreaControl.touched && businessAreaControl.hasError('required')">
                    {{'error.required' | translate}}
                </mat-error>
            </mat-form-field>

            <div class="long-input pb-20">
                <h3 class="attachment-label">
                    {{ 'guidelines.detail.attachment' | translate }} *
                </h3>

                <iihf-attachment-upload
                    [formControlName]="formControlNames.ATTACHMENT"
                    [dragDropLabelKey]="'guidelines.detail.dragAttachment'"
                    [maximumFileSize]="fifteenMBinBytes"
                    (unsupportedFileType)="attachmentUnsupportedFiletype()"
                    (maximumFileSizeExceeded)="attachmentMaximumFileSizedExceeded()"
                ></iihf-attachment-upload>

                <mat-error *ngIf="attachmentRequiredError" class="custom-error">
                    {{ 'error.required' | translate }}
                </mat-error>
            </div>

            <div class="long-input">
                <haz-copy-core-input
                    [label]="'guidelines.detail.description' | translate"
                    appearance="fill"
                    [type]="'textarea'"
                    [formControlName]="formControlNames.DESCRIPTION"
                >
                </haz-copy-core-input>
            </div>

            <mat-form-field appearance="fill" class="long-input theme-input mr-10" *ngIf="hasCreatedSection">
                <mat-label class="label-style">{{ 'guidelines.detail.createdAt' | translate }}</mat-label>
                <input matInput [formControl]="createdAtControl">
            </mat-form-field>

            <ng-container *ngIf="hasChangedSection">
                <div class="long-input">
                    <mat-form-field appearance="fill" class="long-input theme-input mr-10">
                        <mat-label class="label-style">{{ 'guidelines.detail.changedAt' | translate }}</mat-label>
                        <input matInput [formControl]="changedAtControl">
                    </mat-form-field>
                </div>

                <div class="long-input">
                    <mat-form-field appearance="fill" class="long-input theme-input mr-10">
                        <mat-label class="label-style">{{ 'guidelines.detail.changedBy' | translate }}</mat-label>
                        <input matInput [formControl]="changedByControl">
                    </mat-form-field>
                </div>

            </ng-container>
        </form>

        <div>
            <ng-container *ngIf="editMode">
                <button
                    *iihfShowByRole="submitButtonRole"
                    type="submit"
                    mat-flat-button
                    color="accent"
                    class="mr-10"
                    (click)="onSave()"
                    [disabled]="guidelineDetailForm.invalid"
                >
                    {{ 'guidelines.detail.save' | translate | uppercase }}
                </button>
            </ng-container>

            <button type="button"
                    mat-button
                    class="mr-10"
                    (click)="back()"
            >
                {{ 'guidelines.detail.cancel' | translate | uppercase }}
            </button>
        </div>
    </div>
</div>
